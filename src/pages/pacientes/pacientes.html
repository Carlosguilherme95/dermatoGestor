<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../pacientes/style.css" />
    <title>Cadastro de Paciente</title>
  </head>
  <body>
    <div class="container my-5">
      <h2 class="text-center mb-4">Cadastro de Paciente</h2>

      <!-- Formulário de Cadastro -->
      <form id="cadastroForm">
        <!-- Dados Pessoais -->
        <div class="card mb-4">
          <div class="card-header bg-purple text-white">
            <!-- Alterado para bg-purple -->
            <h5 class="card-title">Dados Pessoais</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="nome" class="form-label">Nome</label>
                <input type="text" id="nome" class="form-control" required />
              </div>

              <div class="col-md-6 mb-3">
                <label for="sobrenome" class="form-label">Sobrenome</label>
                <input
                  type="text"
                  id="sobrenome"
                  class="form-control"
                  required
                />
              </div>

              <div class="col-md-6 mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" id="email" class="form-control" required />
              </div>

              <div class="col-md-6 mb-3">
                <label for="telefone" class="form-label">Telefone</label>
                <input
                  type="text"
                  id="telefone"
                  class="form-control"
                  required
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Dados do Endereço -->
        <div class="card mb-4">
          <div class="card-header bg-purple text-white">
            <!-- Alterado para bg-purple -->
            <h5 class="card-title">Endereço</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="cep" class="form-label">CEP</label>
                <input type="text" id="cep" class="form-control" required />
              </div>

              <div class="col-md-6 mb-3">
                <button
                  type="button"
                  class="btn btn-info mt-4"
                  id="consultarCep"
                >
                  Consultar
                </button>
              </div>

              <div class="col-md-6 mb-3">
                <label for="logradouro" class="form-label">Rua</label>
                <input
                  type="text"
                  id="logradouro"
                  class="form-control"
                  required
                />
              </div>

              <div class="col-md-6 mb-3">
                <label for="bairro" class="form-label">Bairro</label>
                <input type="text" id="bairro" class="form-control" required />
              </div>

              <div class="col-md-6 mb-3">
                <label for="cidade" class="form-label">Cidade</label>
                <input type="text" id="cidade" class="form-control" required />
              </div>

              <div class="col-md-6 mb-3">
                <label for="estado" class="form-label">Estado</label>
                <input type="text" id="estado" class="form-control" required />
              </div>

              <div class="col-md-6 mb-3">
                <label for="unidade" class="form-label"
                  >Unidade (opcional)</label
                >
                <input type="text" id="unidade" class="form-control" />
              </div>
            </div>
          </div>
        </div>

        <!-- Botão de Enviar -->
        <div class="d-flex justify-content-center">
          <button type="submit" class="btn btn-success">Cadastrar</button>
        </div>
      </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      document
        .getElementById("consultarCep")
        .addEventListener("click", function () {
          const cep = document
            .getElementById("cep")
            .value.replace(/[^\d]/g, ""); // Remove tudo que não for número

          if (cep.length === 8) {
            axios
              .get(`https://viacep.com.br/ws/${cep}/json/`)
              .then(function (response) {
                const dados = response.data;
                if (dados.erro) {
                  alert("CEP não encontrado");
                } else {
                  // Preenchendo os campos automaticamente
                  document.getElementById("logradouro").value =
                    dados.logradouro || "";
                  document.getElementById("bairro").value = dados.bairro || "";
                  document.getElementById("cidade").value =
                    dados.localidade || "";
                  document.getElementById("estado").value = dados.uf || "";
                }
              })
              .catch(function (error) {
                console.error("Erro ao consultar o CEP", error);
                alert("Erro ao consultar o CEP");
              });
          } else {
            alert("Por favor, insira um CEP válido.");
          }
        });

      document
        .getElementById("cadastroForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const nome = document.getElementById("nome").value;
          const sobrenome = document.getElementById("sobrenome").value;
          const email = document.getElementById("email").value;
          const telefone = document.getElementById("telefone").value;
          const cep = document.getElementById("cep").value;
          const logradouro = document.getElementById("logradouro").value;
          const bairro = document.getElementById("bairro").value;
          const cidade = document.getElementById("cidade").value;
          const estado = document.getElementById("estado").value;
          const unidade = document.getElementById("unidade").value;

          const userData = {
            nome,
            sobrenome,
            email,
            telefone,
            cep,
            logradouro,
            bairro,
            cidade,
            estado,
            unidade,
          };

          // Enviar os dados para o backend ou serviço de cadastro
          axios
            .post("http://localhost:3000/api/userr", userData)
            .then((response) => {
              console.log(response.data);
              alert("Usuário adicionado com sucesso!");
            })
            .catch((error) => {
              console.error("Erro ao cadastrar o usuário:", error);
              alert("Erro ao cadastrar o usuário.");
            });
        });
    </script>
  </body>
</html>
